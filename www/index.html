<!DOCTYPE html>
<html>
    <head>
        <title>EATON | ANDON LIGHTS NETWORK</title>
        <style>
            html, body{
                margin: 0px auto;
                margin-top: 10px;
                padding: 0px;
                min-width: 720px;
            }
            .left-rtu{
                float: left;
                width: 50%;
            }
            .right-rtu{
                float: left;
                width: 50%;
            }
        </style>
    </head>
    <body>
        <div id="contentwrapper">
            <div class="left-rtu">
                <table id="lefttable"></table>
                <!--<table>
                    <tr><td>
                    <div style="
                        background-color: blue;
                        width: 50px;
                        height: 50px;
                        float: left;
                        border-radius: 50px;
                        margin-left: 15px;
                    "></div>
                    <div style="
                        margin-left: 10px;
                        margin-top: 10px;
                        font-size: 20px;
                        float: left;
                    ">192.168.100.119 | aa:bb:cc:11:22:33:44 | PL1 | 9:19 AM 09/08/2018</div>
                    </td></tr>
                </table>-->
            </div>
            <div class="right-rtu">
                <table id="righttable"></table>
                <!--<table>
                    <tr><td>
                        <div>
                            <div style="
                                background-color: blue;
                                width: 50px;
                                height: 50px;
                                float: left;
                                border-radius: 50px;
                                margin-left: 15px;
                            "></div>
                            <div style="
                                margin-left: 10px;
                                margin-top: 10px;
                                font-size: 20px;
                                float: left;
                            ">192.168.100.119 | aa:bb:cc:11:22:33:44 | PL1 | 9:19 AM 09/08/2018</div>
                        </div>
                    </td>
                    </tr>
                </table>-->
            </div>
        </div>
    </body>
    <script>
        setInterval(function(){
            if (window.XMLHttpRequest)
            {// code for IE7+, Firefox, Chrome, Opera, Safari
                xmlhttp=new XMLHttpRequest();
            }
            else
            {// code for IE6, IE5
                xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
            }
            xmlhttp.onreadystatechange=function()
            {
                if (xmlhttp.readyState==4 && xmlhttp.status==200)
                {
                    db_mac = eval(xmlhttp.responseText);
                    active_macs = db_mac[0]
                    last_reports = db_mac[1]
                    
                    document.getElementById("lefttable").innerHTML = ""

                    var node_red = '<tr><td><div style="background-color: red; width: 50px; height: 50px; float: left; border-radius: 50px; margin-left: 15px;"></div><div style="margin-left: 10px; margin-top: 10px; font-size: 20px; float: left;">'
                    var node_green = '<tr><td><div style="background-color: green; width: 50px; height: 50px; float: left; border-radius: 50px; margin-left: 15px;"></div><div style="margin-left: 10px; margin-top: 10px; font-size: 20px; float: left;">'
                    var node_orange = '<tr><td><div style="background-color: orange; width: 50px; height: 50px; float: left; border-radius: 50px; margin-left: 15px;"></div><div style="margin-left: 10px; margin-top: 10px; font-size: 20px; float: left;">'
                    var node_black = '<tr><td><div style="background-color: black; width: 50px; height: 50px; float: left; border-radius: 50px; margin-left: 15px;"></div><div style="margin-left: 10px; margin-top: 10px; font-size: 20px; float: left;">'
                    if(last_reports.length==0){
                        document.getElementById("lefttable").innerHTML = "No available data"
                    }
                    var side=1; // Accumulator for determining which side of the screen
                    for(var r=0; r<last_reports.length; r++){
                        var devicename = last_reports[r][1]
                        var mac = last_reports[r][2]
                        var status = last_reports[r][3]
                        var time = last_reports[r][4]
                        if(status=="1"){
                            var node_color = node_green;
                        }else if(status=="2"){
                            var node_color = node_orange;
                        }else if(status=="3"){
                            var node_color = node_red;
                        }
                        
                        // Check if report origin is active
                        var is_active = 0
                        if(active_macs.length==0){
                            var node_color = node_black;
                        }else{
                            for(var i=0; i<active_macs.length; i++){
                                if(active_macs[i]==mac){
                                    // Device is still active
                                    is_active = 1;
                                }
                            }
                        }
                        //console.log(mac+">>>is_active="+is_active)
                        if(!is_active){
                            node_color = node_black;
                        }
                        var node = node_color + devicename.toUpperCase() + " | " + mac + " | " + time +'</div></td></tr>';
                        if(side<13){
                            document.getElementById("lefttable").innerHTML += node;
                        }else{
                            document.getElementById("righttable").innerHTML += node;
                        }
                        side++;
                    }
                }
            }
            xmlhttp.open("GET", window.location.href+"active", true );
            xmlhttp.send();
        }, 100);
    </script>
</html>